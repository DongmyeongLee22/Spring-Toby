# Chapter 1

## 1.1 초난감 DAO
### [1) step1](step1/UserDao.java)

#### 코드의 문제점
- 변화에 유연하지 못하다.
- 변화에 대비하는 가장 좋은 방법은 변화의 폭을 줄이는 것이다.
- '분리와 확장'을 고려한 설계는 변화에 유연하게 대응할 수 있다.
- 프로그래밍의 기초 개념중 '관심사의 분리'를 객체지향에 적용하여야 한다.

**add() 메서드의 문제점**
- 3가지의 관점이 존재한다.
- 1\) DB와 연결을 위한 괌심
- 2\) 쿼리를 날리는 관심
- 3\) 사용 리소스를 반환하는 관심

---

## 1.2 DAO 분리
### [2) step2](step2/UserDao.java)
- 커넥션을 메서드로 추출하여 유연한 코드로 설계

### [3) step3](step3)
- 추상 클래스로 구현하여 상속을 통한 확장 지원
- 부모 클래스에서 기본적인 로직의 흐름을 정의하고 일부를 서브 클래스에서 구현하게하는 "템플릿 메서드 패턴" 적용
- **이는 스프링에서 애용되는 디자인 패턴 중 하나이다**
- 또 해당 코드는 다른 메서드에서 사용할 객체를 서브클래스에서 결정하는 "팩토리 메서드 패턴"도 적용되었다.

> 이 두가지 패턴을 사용하면 관심사항이 다른 코드를 분리해내 서로 독립적으로 변경, 확장 가능하게 설계할 수 있는 간단하면서도 효과있는 방법이다.

**하지만 상속을 사용했다는 단점이 존재한다.**
- 단지 커넥션 객체를 가져오기 위해 상속구조를 만들면 다른 목적으로 UserDao를 상속하기 힘들다.
- 상속을 통한 상하위 클래스의 관계는 결합도가 강하다.

---

## 1.3 DAO 확장
### [4) step4](step4)
- 추상클래스를 만들어서 변화가 필요한 부분을 분리하여 독립적으로 변경할 수 있게 했지만, 상속이라는 방법을 사용한 단점이 존재한다.
- DB 커넥션과 관련된 부분을 서브 클래스가 아닌 별도에 클래스를 담으면 상속이 필요없고 독립된 클래스를 만들 수 있다.
- 오브젝트 사이의 관계는 런타임 시에 한쪽이 다른 오브젝트의 참조를 갖고 있는 방식으로 만들어진다.
- 제3인 오브젝트인 클라이언트(UserDaoTest)에서 자신이 사용할 커넥션을 직접 선택하도록 책임을 넘겨주도록 설계한다면 UserDao는 오직 인터페이스에 대해서만 의존하면 된다.

> 이렇게 인터페이스를 도입하고 클라이언트의 도움을 얻는 방법은 상속을 사용해 비슷한 시도를 했을 경우보다 훨씬 유연하게 설계가 가능하다.
> 아무리 DAO가 많아져도 DB 접속 방법에 대한 관심은 오직 ConnectionMaker으로 집중된다.

- UserDao는 **전략 패턴을** 이용해 인스턴스를 생성할 때 클라이언트가 선택한 ConnectionMaker의 구현체를 파라미터로 받아 사용하게 된다.

#### 개방 폐쇠 원칙
- 클래스나 모듈은 확장에는 열려있고 변경에는 닫혀있어야한다는 원칙을 UserDao를 지키고 있다.
- 먼저 Connection에 대한 기능을 확장하는데에 열려있다.
- UserDao에 전혀 영향을 주지 않고 언제든지 확장이 가능하다.
- 동시에 핵심 기능을 구현한 코드는 변화에 영향을 받지않고 유지할 수 있으므로 닫혀있다고 할 수 있다.

> 잘 설계된 객체지향 클래스 구조는 이 원칙을 아주 잘 지키고 있다.

#### 높은 응집도와 낮은 결합도
- 응집도란 특정 모듈, 클래스에 얼마만큼 하나의 책임, 관심사에 집중되어있는지에 대한 정도이다.
- 결합도란 오브젝트들 간에 의존하고 있는 정도를 나타낸다.

**높은 응집도**
- 응집도가 높다는 것은 변화가 일어날 때 해당 모듈에서 변하는 부분이 크다는 것이다.
- 어떤 변경이 일어날 때 모듈의 일부분에만 변경이 일어난다면 어떤 부분이 변경되었는지, 그 변경으로 인한 영향이 무엇인지에 대해 생각해야한다.
- 초난감 DAO는 커넥션 변경이 일어날 때 UserDao의 일부분만 변경된다. 그러므로 해당 변경시 일어날 영향에 대해 일일히 확인해야 한다.
- ConnectionMaker인터페이스일 경우 커넥션 변경이 일어나면 새로운 구현체를 만들기만 하면된다. 이는 UserDao에게 전혀 영향을 주지 않는다.

**낮은 결합도**
- 관계는 꼭 필요한 최소한의 방법만 간접적인 형태로 제공하고, 나머지는 서로 독립적이고 알 필요없게 만들어 결합도는 낮추는 것이 좋다.
- 결합도가 낮아지면 변화에 대응하기 쉬워지고, 구성이 깔끔해진다.
- UserDao는 커넥션을 만들기 위해 꼭 필요한 ConnectionMaker에만 의존하고 있지 해당 구현체에는 전혀 의존하고 있지 않다.

---
## 1.4 제어의 역전(IoC)

### [5) step5](step5)
- UserDao의 확장성을 위해 UserDaoTest가 커넥션의 구현체를 생성할 책임을 떠맡았다.
- 하지만 UserDaoTest는 테스트를 위한 책임을 가지고 있지 커넥션 생성에 대한 책임을 가지고 있지 않다.
- 기능을 분리하여 UserDao와 ConnectionMaker 구현 클래스의 오브젝트를 만드는 것과, 그렇게 만들어진 두 개의 오브젝트가 연결돼서 사용될 수 있도록 관계를 맺어주자.

**팩토리**
- 객체의 생성 방법을 결정하고 만들어진 오브젝트를 돌려주는 것을 흔히 팩토리라고 부른다.
- 디자인 패턴에서 말하는 팩토리 패턴이 아닌 **단지 오브젝트를 생성하는 쪽과 생성된 오브젝트를 사용하는 쪽의 역할과 책임을 깔끔하게 분리하려는 목적이다.**


> - 이를 통해 UserDao와 ConnectionMaker는 각 애플리케이션의 핵심적인 데이터 로직, 기술 로직을 담당한다.
> - DaoFactory는 이런 애플리케이션의 오브젝트들을 구성하고 그 관계를 저의하는 책임을 맞고 있다.
