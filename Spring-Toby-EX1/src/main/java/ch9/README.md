# Chapter9. 스프링 프로젝트 시작하기
### 9.1 자바 엔터플라이즈 플랫폼과 스프링 애플리케이션
- 자바 엔터프라이즈 애플리케이션은 서버에서 동작하며 클라이언트를 상대로 서비스를 제공한다.
- 하지만 클라이언트의 요청 없이도 정해진 시간이나 특정 이벤트 발생에 따라 독자적인 작업을 수행하기도 한다.

### 9.1.2 애플리케이션 서버
- 스프링으로 만든 애플리케이션을 자바 서버환겨엥 배포하려면 JavaEE서버가 필요하다.
- JavaEE 표준을 따르는 애플리케이션 서버는 크게 두가지로 구분되는데 하나는 JavaEE의 대부분의 표준 기술을 지원하고 다양한 형태의 모듈로 배포가 가능한 완전한 WAS이고, 다른 하나는 웹 모듈의 배포만 가능한 경량급 WAS이다.

#### 경량급 WAS/서블릿 컨테이너
- 스프링은 기본적으로 톰캣이나 제티같은 가벼운 서블릿 컨테이너만 있어도 충분하다.
- EJB나 리소스 커넥터, WAS가 제공하는 분산 서비스등이 굳이 필요하지 않다면 서블릿 컨테이너 만으로 엔터픙지드 애플리케이션에 필요한 핵심기능을 모두 이용할 수 있다.

#### WAS
- 고가의 WAS를 사용하면 그만큼 장점이 존재한다.
- 성능면에서는 대단히 차이가 나지 않더라도 미션 크리티컬한 시스템에서 요구하는 고도의 안전성이나 고성능 시스템에서 필수적으로 안정적인 리소스 관리, 레거시 시스템의 연동이나 기존 EJB로 개발된 모듈을 함께 사용하는 등의 필요가 있다면 WAS가 유리할 것이다.

---

## 9.3 애플리케이션 아키텍쳐
### 9.3.1 계층형 아키텍쳐
- 보통 웹 기반의 엔터프라이즈 애플리케이션은 일반적으로 세 개의 계층을 갖는다고 해서 3계층(3-tier or 3-layer) 애플리케이션이라고도 한다.


### 데이터 중심 아키텍처
#### DB/SQL 중심의 로직 구현 방식
- DB 중심의 업무 단위로 코드를 만들면 해당 코드는 재사용이 불가능해진다.
- 객체지향적인 특성을 활용하지 못해 필드 하나가 달라지면 비슷한 DAO를 또 만들어야할 수 있다.
- 그리고 SQL이 복잡해질 수록 DB에 무리가 갈 것이고 확장이 필요해질 것이다.
- DB는 확장이 쉽지 않을 뿐더러 가격이 비싸다. 그에 비해 서버를 확장하는 것은 어렵지않고 가격도 DB에 비해 저렴하다.
- 뿐만아니라 SQL이나 저장 프로시저에 담긴 로직은 테스트하기가 힘들다. 반면 오브젝트에 담긴 로직은 간단히 검증이 가능하다.
- 따라서 DB에는 부하를 가능한 한 주지 않는 간단한 작업만 하고 복잡한 로직은 오브젝트에 담아서 애플리케이션 내에서 처리하도록 만드는 편이 낫다.

#### 거대한 서비스 계층 방식
- DB에서 가져온 데이터가 애플리케이션에 흘러다니는 정보의 중심이 되는 아키텍처이지만 DB에 많은 로직을 두는 개발 방법의 단점을 피하면서 애플리케이션 코드의 비중을 높이는 방법이 있다.
- DB에는 부하가 걸리지 않을 정도로 사용하고 주요 로직을 서비스 계층의 코드에서 처리하는 것이다.
- 하지만 데이터 엑세스 계층의 SQL은 서비스 계층의 비즈니스 로직의 필요에 따라 만들어지기 쉽다. 그러므로 계층간의 결합도가 크다.
- 그리고 DAO의 반환 타입에 대한 의존성이 강하므로 비슷한 로직이 있더라도 재사용이 힘들어진다.
- 각 단위 업무별로 독립적인 개발과 초기 개발 속도가 빠르다는 장점이 있겠지만 객체지향적인 설계를 적용하기 힘들고 시스템이 거대해질 수록 유지보수가 어려워진다.

### 오브젝트 중심 아키텍처
- 오브젝트 중심 아키텍처가 데이터 중심 아키텍처와 다른 가장 큰 특징은 도메인 모델을 반영하는 오브젝트 구조를 만들어두고 그것을 각 계층 사이에서 정보를 전송하는데 사용한다는 것이다.
- 해당 도메인은 모든 계층에서 사용할 수 있으며 연관된 데이터들을 필드로 가지고 있기 때문에 서비스계층에서는 원하는 도메인을 DAO에게 요청하고 해당 도메인에 맞는 비즈니스 로직만을 수행하면된다.
- 서비스에서는 데이터 액세스 레이어가 어떻게 데이터를 가져오는지 상관하지 않고 오직 해당 도메인들을 반환해주기만 하면된다.
- 서로의 의존성을 떨어트려 재사용이 가능해질 뿐만아니라 객체지향적으로 받아온 도메인 데이터들을 관리할 수 있어 코드가 이해하기 쉬워지고 유연해진다.
- 다만 성능면에서는 최적화된 SQL에 비해 떨어질 수 있다. DAO는 비즈니스 로직의 사용방식을 알지못하므로, 도메인 오브젝트의 모든 필드 값을 다 채워서 전달하는 경우가 대부분이다.
- 그런데 하나의 오브젝트의 담긴 필드의 개수가 많아지다 보면 그중에는 드물게 사용되는 필드도 있을 수 있다.
- 즉 비즈니스 로직에 따라 필요한 정보의 양이 다를 수 있어 리소스가 효율적으로 사용되지 못할 수 있다.
- 그리고 사용되지 않는 필드의 참조 객체들을 조회하지 않는다만 null값이 될 수도 있다.

> - 오브젝트 중심의 아키텍처는 도메인 모델을 따르는 오브젝트를 사용해 각 계층 사이에 정보를 전달하고, 이를 이용해 비즈니스 로직이나 프레젠테이션 로직을 작성한다.
> - 계층 간의 결합도는 낮아지고 일관된 정보 모델을 사용하기 때문에 개발 생산성과 코드의 품질, 테스트의 편의성도 향상시킬 수 있다.

- 도메인 오브젝트는 빈이 아니므로 DAO 오브젝트를 DI 받을 수 없다.
- 도메인 오브젝트는 애플리케이션의 코드 또는 기타 프레임워크나 라이브러리, JDBC 템플릿 등에 의해 필요할 때마다 새롭게 만들어진다. 그러므로 도메인 오브젝트는 스프링의 빈의 기능을 사용할 수 없다.
- 그러므로 서비스 계층은 코드는 필시 필요하다.
- 도메인 자체에 대한 로직은 서비스 계층이아닌 도메인 오브젝트에 존재해야 한다.
- 그것이 객체지향에서 상태와 행위를 동시에 가지는 진정한 객체이며 자신의 행위에 대한 책임을 자신이 진다면 의도가 명확해지고 재사용성이 올라갈 것이다.

### 서드파티 프레임워크, 라이브러리 적용
#### 1) 해당 기술을 스프링 Di 패턴에 따라 사용가능
- 스프링이 공식적으로 지원하는 기술이라면 해당 라이브러리를 코드들을 통해 초기화해야 사용할 수 있는 것들을 빈으로 등록하는 것만으로 사용가능하게 해준다.
- 하이버네트의 기능을 사용하기 위해서는 SessionFactory 오브젝트를 만들어야 하는데 이를 만들기 위해서는 설정파일에 대한 정보, 설정 값을 담을 프로퍼티와 DB 연결에 대한 정보등이 필요하다.
- 스프링에서는 하이버네이트의 SessionFactory를 스프링이 제공하는 빈을 등록하는 것만으로 간단히 생성할 수 있게 해주는 LocalSessionFactoryBean이라는 클래스를 제공한다.
- LocalSessionFactoryBean 클래스를 빈으로 등록하고 적절한 프로퍼티를 설정해주면 간단히 SessionFactory 오브젝트가 만들어져 빈으로 등록된다.

#### 2) 스프링의 서비스 추상화가 적용
#### 3) 스프링이 지지하는 프로그래밍 모델을 적용
#### 4) 템플릿/콜백 지원

### 스프링이 지원하지 않는 기술
- 스프링이 지원하지 않는 기술을 써야할 때는 스프링다운 기술들을 써서 직접 적용하면된다.
- 먼저 스프링의 빈으로 해당 기술의 핵심 오브젝트가 등록되도록 만든다.
- 필요에 따라 팩토리 빈을 사용해서 오브젝트 생성과 초기화 작업, 프로퍼티 노출 등을 해줘야 한다.
- 애플리케이션 내의 빈들이 새로운 기술에 대해 빈을 DI 하는 방법으로 접근할 수 있게 하는 것이다.
- 반대로 빈 오브젝트를 새로 추가할 기술에서 사용할 수도 있다.
- 그리고 상황에 맞게 서비스 추상화를 시도해보고 템플릿/콜백 방식을 적극 고려하자.
- 뿐만아니라 AOP나 예외 전환이 필요하다면 이를 적극활용하여 스프링에 맞게 해당 기술들을 사용하자.
- 해당 기술을 변경해서 사용한다면 이후 버전에 대한 호환성의 문제가 발생할 수 있다.
- 그래서 종종 예외 변환은 AOP을 통해 많이 이루어진다.
