# Chapter4. 예외
- JdbcTemplate을 대표로 하는 스프링의 데이터 엑세스 기능에 담겨 있는 예외처리와 관련된 접근 방법에 대해 알아보며 예외를 처리하는 베스트 프랙티스를 살펴본다.

## 4.1 사라진 SQLException

### 4.1.1 초난감 예외처리
- 예외를 처리할 때 catch문으로 예외를 잡고 그 예외에 대한 아무런 동작을 하지 않는것은 연습상황에도 해서는 안되는 습관이다.
- 이러한 습관이 나중에 실무에서 적용되면 매우 위험한 결과를 초래할 수 있다.
- 그렇다고 해당 예외를 printStackTrace()하는 것도 좋은 방법이 아니다.
- 로그는 금방 묻혀버리고 놓치기 쉽기 때문에 이 또한 위험한 결과를 초래할 수 있다.
- **모든 예외를 적절하게 복구되든지 아니면 작업을 중단시키고 운영자 또는 개발자에게 분명하게 통보돼야 한다.**
- [UserDao](step1/UserDao.java)에서 jdbcTemplate를 사용하였더니 예외가 사라졌다.

---

### 4.1.2 예외의 종류와 특징
- trhow를 통해 발생시킬 수 있는 예외는 크게 세 가지가 있다.

#### Error
- 에러는 시스템에 뭔가 비정상적인 상황이 발생했을 경우에 사용되며 주로 JVM에서 발생시키는 것이다.
- 즉 애플리케이션 코드에서 잡을 수 없고 시스템단에서 잡아야하므로 애플리케이션에서는 이 예외처리를 신경쓰지 않아도 된다.

#### UnChecked Exception
- RuntimeException의 하위 클래스들로 주로 프로그램 오류가 있을 때 발생하도록 의도된 것이다.
- NullPointerException, IllegalArgumentException 등과 같이 프로그래머의 부주의로 발생하는 것들이다.
- 그렇기 때문에 해당 예외 처리를 강제하지 않는다.

#### Checked Exception
 - 반드시 처리를해야하는 예외들로 JDK 초기에 만들어진 것들은 대부분 체크 예외로 구성되어 있다.
 
 ---
 
### 4.1.3 예외 처리 방법
#### 예외 복구
- 예외 상황을 파악하고 문제를 해결하여 정상 상태로 놀려 놓는 기법이다.
- 사용자가 해당 파일을 이용하려고할 때 예외가 발생한다면 다른 파일을 이용하도록 자연스럽게 흐름을 유도해주는 방식으로 복구할 수 있다.
- 해당 예외가 사용자에게 그대로 던져지는 것은 예외 복구라고할 수 없다.
- 즉 예외가 처리 됐으면 비록 기능적으로는 사용자에게 예외상황으로 비칠 수 있어도 애플리케이션에서는 정상적으로 설계된 흐름을 따라 진행돼야 한다.

> 예외처리 코드를 강제하는 체크 예외들은 예외를 어떤 식으로 복구할 가능성이 있는 경우에 주로 사용된다.

#### 예외처리 회피
- 예외처리를 자신이 담당하지 않고 다른 쪽에게 던져버리는 기법이다.
- catch문으로 예외를 잡은 후 로그를 남기고 다시 예외를 던지는 식으로 처리를 회피할 수 있다.
- 예외를 회피하는 것은 예외를 복구하는 것 처럼 의도가 분명해야 한다.
- 템플릿 / 콜백 처럼 긴밀한 관계에 있는 다른 객체에게 책임을 분명히 지게하거나, 자신을 사용하는 쪽에서 예외를 처리하는게 최선이라는 확신이 있을 때 이러한 방법을 사용해야 한다.

#### 예외 전환
- 예외 회피와 비슷하게 예외를 복구해서 정상적인 상태로 만들 수 없기 때문에 예외를 메서드 밖으로 던져버리는 것이다.
- 대신 예외처리와는 다르게 다른 예외로 전환해서 던진다는 특징이 있다.

**예외 전환은 보통 두가지 목적으로 사용된다.**
- 내부에서 발생한 예외를 그대로 던지는 것이 그 상황에 맞게 적절한 의미를 부여해주지 못하였을 때 의미를 분명히 전달하기 위함이다.
- 사용자가 회원가입을할 때 중복아이디가 있을 때 JDBC는 SQLException이 발생하지만 DAO가 이를 그대로 던져버리면 서비스레이어에서는 이를 이해하기 어려워 진다.
- 그러므로 해당 정보에 알맞는 예외로 전환하여 던져야 더욱 분명하게 예외를 처리할 수 있게 된다.
- **보통 예외 ㅈ전환은 이전의 예외를 담아서 중첩 예외로 던지는 것이 근본적인 원인을 알릴 수 있어 유용하다.**

```java
catch(SQLException e){
    throw DuplicationUserIdException(e);
}
```

> - 대부분 서버환경에서는 애플리케이션 코드에서 처리하기 않고 전달된 예외들을 일괄적으로 다룰 수 있는 기능을 제공한다.
> - 어차피 복구하지 못할 예외라면 애플리케이션 코드에서는 런타임 예외로 포장해서 던져버리고, 예외처리 서비스 등을 이용해 자세한 로그를 남기고, 관리자에게 통보할 수 있게하는것이 바람직하다.
